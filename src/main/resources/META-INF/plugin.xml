<idea-plugin>
  <depends>com.intellij.modules.platform</depends>
  <resource-bundle>messages.PromptPackBundle</resource-bundle>

  <extensions defaultExtensionNs="com.intellij">
    <!-- Оставим два notificationGroup, чтобы совместимо с кодом было и старое, и новое -->
    <notificationGroup id="PromptPack" displayType="BALLOON" isLogByDefault="true"/>
    <notificationGroup id="Open Tabs Tools" displayType="BALLOON" isLogByDefault="true"/>

    <applicationConfigurable
            id="dev.promptpack"
            parentId="tools"
            key="configurable.name"
            bundle="messages.PromptPackBundle"
            instance="dev.promptpack.PromptPackConfigurable"/>
  </extensions>

  <actions>
    <!-- ВЕРХНЕУРОВНЕВАЯ ГРУППА МЕНЮ -->
    <group id="PromptPack.Menu" text="PromptPack" popup="true">
      <add-to-group group-id="ToolsMenu" anchor="last"/>
      <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
    </group>

    <!-- Копирование контента -->
    <action id="PromptPack.CopySelectedItemsContents"
            class="dev.promptpack.CopySelectedItemsContentsAction">
      <add-to-group group-id="PromptPack.Menu" anchor="first"/>
      <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt C"/>
    </action>

    <!-- Подменю режима дерева -->
    <group id="PromptPack.TreeScopeGroup"
           class="dev.promptpack.TreeScopeGroupAction"
           popup="true">
      <add-to-group group-id="PromptPack.Menu" anchor="last"/>
    </group>
    <action id="PromptPack.TreeScope.Project"   class="dev.promptpack.TreeScopeProjectToggleAction">
      <add-to-group group-id="PromptPack.TreeScopeGroup" anchor="last"/>
    </action>
    <action id="PromptPack.TreeScope.Selection" class="dev.promptpack.TreeScopeSelectionToggleAction">
      <add-to-group group-id="PromptPack.TreeScopeGroup" anchor="last"/>
    </action>
    <action id="PromptPack.TreeScope.None"      class="dev.promptpack.TreeScopeNoneToggleAction">
      <add-to-group group-id="PromptPack.TreeScopeGroup" anchor="last"/>
    </action>

    <!-- Быстрое переключение -->
    <action id="PromptPack.TreeScope.Cycle" class="dev.promptpack.CycleTreeScopeAction">
      <add-to-group group-id="PromptPack.Menu" anchor="last"/>
      <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt T"/>
    </action>

    <!-- Чёрный список -->
    <action id="PromptPack.EditBlacklist" class="dev.promptpack.EditBlacklistAction">
      <add-to-group group-id="PromptPack.Menu" anchor="last"/>
    </action>

    <!-- Diff -->
    <action id="PromptPack.DiffWithDefaultBranch"
            class="dev.promptpack.DiffWithDefaultBranchAction">
      <add-to-group group-id="PromptPack.Menu" anchor="last"/>
      <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt D"/>
    </action>

    <!-- NEW: Toggle Public API section -->
    <action id="PromptPack.TogglePublicApi"
            class="dev.promptpack.TogglePublicApiAction"
            descriptionKey="action.togglePublic.description"
            textKey="action.togglePublic.text">
      <add-to-group group-id="PromptPack.Menu" anchor="last"/>
      <!-- macOS: Shift-Option-Command-P -->
      <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift alt P"/>
    </action>
  </actions>
</idea-plugin>
